


# 오류 1

##### bad gateway 오류 발생
## 문제 원인: OOMKilled (메모리 부족)

Frontend 컨테이너가 OOMKilled (Out of Memory) 상태로 종료되고 있습니다:

- Exit Code: 137 (OOMKilled)

- 메모리 제한: 1Gi

- 메모리 요청: 512Mi

Next.js with Turbopack이 개발 모드에서 메모리를 많이 사용하는 것 같습니다.

### 해결책: 메모리 제한 증가

```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: frontend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: frontend
  template:
    metadata:
      labels:
        app: frontend
      annotations:
        kubectl.kubernetes.io/restartedAt: "2025-06-09T18:08:35+09:00"--> 이 부분 수정함
    spec:
      containers:
      - name: frontend
        image: frontend:v2
        ports:
        - containerPort: 3000
        env:
        - name: NODE_ENV
          value: "development"
        - name: NEXT_TELEMETRY_DISABLED
          value: "1"
        - name: NEXT_PUBLIC_API_URL
          value: "http://localhost:8080"
        - name: NEXTAUTH_URL
          value: "http://localhost:8080"
        - name: NEXTAUTH_SECRET
          value: "your-super-secret-key-for-development-only"
        - name: USE_MOCK_API
          value: "true"
        - name: GOOGLE_CLIENT_ID
          value: "dummy-client-id"
        - name: GOOGLE_CLIENT_SECRET
          value: "dummy-client-secret"
        resources:
          requests:
            memory: "1Gi"
            cpu: "250m"
          limits:
            memory: "2Gi"
            cpu: "1000m"
---
apiVersion: v1
kind: Service
metadata:
  name: frontend
spec:
  selector:
    app: frontend
  ports:
  - protocol: TCP
    port: 3000
    targetPort: 3000
  type: ClusterIP
```
# 오류 2


##### 구글 계정으로 로그인이 안되고 계속 제한됨 --> Google Cloud Console에서 Redirect URI 추가함

🔧 Google Cloud Console에서 Redirect URI 추가하는 방법

현재 사용자께서 Google Cloud Console의 API 및 서비스 페이지에 있으신 것 같습니다. 다음 단계를 따라해주세요:

### 1️⃣ OAuth 2.0 클라이언트 ID 찾기

- 화면에서 "OAuth 2.0 클라이언트 ID" 섹션을 찾으세요

- "LIF-250411" 이름의 클라이언트를 찾으세요

- Client ID: 485757759622-......(찾으면 됨)

### 2️⃣ 클라이언트 편집

- "LIF-250411" 항목을 클릭하거나 편집 버튼(연필 아이콘)을 클릭하세요

### 3️⃣ 승인된 리디렉션 URI 섹션 찾기

편집 페이지에서 다음을 찾으세요:

- "승인된 리디렉션 URI" 또는 "Authorized redirect URIs" 섹션

- 이 섹션에 현재 설정된 URI들이 표시됩니다 (아마도 http://localhost:3000/api/auth/callback/google)

### 4️⃣ 새로운 URI 추가

- "URI 추가" 또는 "+ ADD URI" 버튼을 클릭하세요

```
  http://localhost:8080/api/auth/callback/google
```

### 5️⃣ 저장

- "저장" 또는 "SAVE" 버튼을 클릭하세요

## 📋 최종 결과

설정 완료 후 승인된 리디렉션 URI 목록에 다음 두 개가 모두 있어야 합니다:

- http://localhost:3000/api/auth/callback/google (기존)

- http://localhost:8080/api/auth/callback/google (새로 추가)

## 🎉 이제 테스트해보세요!

이제 http://localhost:8080/auth/login에서 Google 로그인이 정상적으로 작동할 것입니다!

1. 페이지 로드 → ✅

2. Google 로그인 버튼 클릭 → ✅

3. Google 인증 → ✅

4. 콜백 처리 → ✅ (리디렉션 URI가 설정됨)

5. 메인 페이지로 리디렉션 → ✅

더 이상 빌드나 재배포는 필요하지 않습니다! 🎯


#### 오류 3

## 🔍 Secret 값 확인 완료!

frontend-secret.yaml 파일에 저장된 값들을 확인했습니다:

### ✅ 현재 저장된 자격증명

- Google Client ID: (깃 커밋때문에 지움움)

- Google Client Secret: (깃 커밋때문에 지움)
### 🚨 문제점 발견!

이 값들은 frontend/.env 파일에 있는 것과 정확히 동일합니다. 하지만 로그에서 invalid_client (Unauthorized) 에러가 발생하고 있습니다.

## 🛠️ 해결 방법

### 1단계: Secret이 제대로 적용되었는지 확인

```
kubectl describe deployment frontend | findstr -A 20 "Environment:"
```

```
kubectl get pods -l app=frontend -o jsonpath="{.items[0].spec.containers[0].env[?(@.name=='GOOGLE_CLIENT_ID')]}"
```

좋습니다! Pod가 올바르게 Secret을 참조하고 있네요. 이제 Google OAuth 자격증명이 실제로 유효한지 확인해보겠습니다.

### 2단계: Google OAuth의 실제 문제 진단

invalid_client (Unauthorized) 에러는 다음과 같은 이유로 발생할 수 있습니다:

1. Client Secret이 만료되었거나 잘못됨

2. OAuth 애플리케이션이 비활성화됨

3. API 키 제한 설정

### 🔧 해결책: 새로운 Client Secret 생성

현재 사용 중인 Client Secret이 문제일 가능성이 높습니다. 새로운 Secret을 생성해보겠습니다.

Google Cloud Console에서 다음 단계를 수행해주세요:

1. Google Cloud Console → APIs & Services → Credentials

2. OAuth 2.0 클라이언트 ID 찾기 (...커밋이 안되서 삭제함함)

3. 해당 클라이언트를 클릭

4. "클라이언트 보안 비밀번호" 섹션에서 "새 보안 비밀번호 만들기" 클릭

5. 새로 생성된 Client Secret 복사

새 Client Secret을 받으면 다음 명령어로 업데이트하겠습니다:

```
# 새 Secret 값을 base64로 인코딩
echo -n "새로운_CLIENT_SECRET" | base64

# Secret 업데이트
kubectl patch secret frontend-secrets -p '{"data":{"google-client-secret":"새로운_base64_값"}}'

# Pod 재시작
kubectl rollout restart deployment/frontend
```

새로운 Google Client Secret을 받으셨나요? 받으시면 알려주시면 바로 업데이트해드리겠습니다! 🔑