
프레임 워크

앱 - 플러터(NestJS,NuxtJS)
웹- Next.JS
서버- FastAPI
DB - postgred

claim:s 정보의 조각

- 토큰: 암호화해서 정보의 조각(=PK)을 보여주는 수단



암호화: 인코딩(코딩을 하는 것 문자를 숫자로 바꾸는 것), 사용자가 볼 수 있는 부분
복호화: 디코딩(코드를 해독하는 것), 

제너레이터 VS  컨스트럭터

- 제너레이션: 계속 이어지는 것. 언제 끝날지는 모르고, 계속 지켜봐줘야 한다. 끝날때 개발자가 닫아줘야 한다.

- 컨스트럭터: 계속 이어지는게 없다. 알아서 닫혀진다. 편한데 지속성이 있다. 지씨가 처리해준다.


토큰 - 유효시간 10분....

보안을 위해 만들지만... 토큰은 두 가지가 존재한다. 로그인 할 때만 파이썬에서 access token과 refresh token을 발급해준다.
근데 로그아웃 할 때는 refresh token을 없앤다. 그리고 access token만 움직인다.

- access token - 유효시간을 길게 만드는 것, 30분 정도로 길게 만드는 것...(임시 토큰)
- refresh token - access token을 계속 유효하게 만들어준다. 약 6개월정도까지 길게 유지할 수 있다. access token이 폭파되면, refresh token 이 서버에 access token을 다시 사용할 수 있게 요청할 때만 사용됨


X: 변해서는 안되는 부분(헤더 부분), O: 변해도 되는 부분 (리퀘스트 바디)
![[Pasted image 20250328102338.png]]


토큰: 비번의 대체제
아이디랑 비번을 다 감싸는 것을 토큰에 감싼다고 한다.

디코딩 정보를 chat gpt에 주고, 인코딩을 짜달라고 해야한다. 근데 

라우터에다가 토큰을 발급하면 안된다. 약간 보이는 식당같은 느낌이다.


로그인 성공하면, 프론트에다가 주면 
![[Pasted image 20250328102154.png]]


stmt를 실행해야 result가 나온다.

토큰 설정하기 위해

1. 서비스의  user_lookup.py의 부분에 로그인 성공 전에  `create_access_token()`과 `create_refresh_token()` 함수 구현하기(쳇 지피티에 물어보기)....내 부분은 서비스 부분이 오류가 있어서 다시 수정하였다. 
2. token_utils.py 같은 모듈에 정의된 함수  만들기. "서비스 부분 을 복붙하고나서, 헤더는 { "alg": "HS256", "typ": "JWT" }이고, payload는 { "sub": "logged_in_user.user_id", "name": "logged_in_user.name", "admin": true, "iat": 파이썬에서 발급한 시간 }이야. create_access_token과 create_refresh_token은 별도의 메소드로 리팩토링 된 상태로 작성해줘."라고 쳇지피티에 물어보기

3. --> utils 폴더에 coonfig 폴더에 security폴더에 jwt_config.py 파일 만들기 

JWT는 Python에서 일반적으로 `PyJWT` (`jwt` 라이브러리)를 사용하므로 이를 기반으로 작성할게요.

> 🔐 HS256 알고리즘을 사용하고, 헤더는 `{alg: HS256, typ: JWT}`, payload는 직접 설정한 형식을 따릅니다.


촘

![[Pasted image 20250328113934.png]]

#JWT 설정값 (예: 환경변수에서 관리하는 것이 좋음) SECRET_KEY = "your_access_secret_key" REFRESH_SECRET_KEY = "your_refresh_secret_key" ALGORITHM = "HS256" ACCESS_TOKEN_EXPIRE_MINUTES = 15 # 접근 토큰 유효시간 REFRESH_TOKEN_EXPIRE_DAYS = 7 # 리프레시 토큰 유효시간 이 값을 .env에서 관리하도록 수정해줘.


좋아요! JWT 관련 설정값을 `.env` 파일로 분리해서 관리하면 **보안성과 유지보수성이 크게 향상**돼요. 아래에 `.env` 설정과 이를 사용하는 코드 예시를 정리해드릴게요.

### ✅ 1. `.env` 파일에 환경변수 추가

`BACKEND/.env` 파일에 다음을 추가하세요:

env

복사편집

`# JWT settings SECRET_KEY=your_access_secret_key REFRESH_SECRET_KEY=your_refresh_secret_key ALGORITHM=HS256 ACCESS_TOKEN_EXPIRE_MINUTES=15 REFRESH_TOKEN_EXPIRE_DAYS=7`

---

### ✅ 2. `python-dotenv` 설치

`.env` 파일을 불러오기 위해 `python-dotenv` 패키지를 사용해요:

bash

복사편집

`pip install python-dotenv`

---

### ✅ 3. `utils` 또는 공통 설정 모듈에서 환경변수 불러오기

예를 들어 `com/kimdonghee/utils/config.py` 파일을 새로 만들고 아래처럼 작성:

python

복사편집

`import os from dotenv import load_dotenv  # .env 파일 로드 load_dotenv()  # 환경변수 불러오기 SECRET_KEY = os.getenv("SECRET_KEY") REFRESH_SECRET_KEY = os.getenv("REFRESH_SECRET_KEY") ALGORITHM = os.getenv("ALGORITHM", "HS256") ACCESS_TOKEN_EXPIRE_MINUTES = int(os.getenv("ACCESS_TOKEN_EXPIRE_MINUTES", 15)) REFRESH_TOKEN_EXPIRE_DAYS = int(os.getenv("REFRESH_TOKEN_EXPIRE_DAYS", 7))`

---

### ✅ 4. JWT 생성 함수에서 사용

`create_access_token`, `create_refresh_token` 함수가 있는 파일에서 다음과 같이 불러오면 됩니다:

python

복사편집

`from com.kimdonghee.utils.config import (     SECRET_KEY,     REFRESH_SECRET_KEY,     ALGORITHM,     ACCESS_TOKEN_EXPIRE_MINUTES,     REFRESH_TOKEN_EXPIRE_DAYS, )`

---

### ✅ 보너스: `Dockerfile` 또는 `uvicorn` 실행 시 `.env` 반영

만약 Docker 환경이라면 `.env` 파일이 컨테이너에 복사되고, 환경변수로 자동 반영되도록 설정해줘야 해요.  
필요하면 `Dockerfile`, `docker-compose.yml`도 도와줄게요.

---

필요하면 `refresh_token`에는 `REFRESH_SECRET_KEY`를 따로 쓰도록 구분해줄 수도 있어요. 원해?




![[Pasted image 20250328114434.png]]

현재 난 .gitignore 파일이 없어. 깃에 .env가 들어가면 안되서 만들려고 해. 이 구조에 맞게 너가 작성해줘.

###### ChatGPT의 말:

좋아요! `.env` 파일은 절대 Git에 올라가면 안 되기 때문에 `.gitignore` 파일을 만들어서 관리해야 해요.

---

### ✅ 1. 프로젝트 구조에 맞는 `.gitignore` 생성

당신의 프로젝트 루트 디렉토리는 `BACKEND`로 보이고, 여기에 `.env` 파일이 있어요.  
따라서 `.gitignore` 파일을 **`BACKEND` 폴더 안**에 만들어야 합니다.

---

### ✅ 2. `.gitignore` 내용 예시 (Python + FastAPI + Docker + VSCode 기준)

gitignore

복사편집

`# Python __pycache__/ *.py[cod] *.pyo *.pyd *.pyc *.pkl *.sqlite3 *.db  # 환경설정 .env  # VSCode 설정 .vscode/  # Docker *.log docker_command.txt *.pid  # OS 파일 .DS_Store Thumbs.db  # MyPy, Pylint 등 .mypy_cache/ .pytest_cache/ .pyre/ .cache/ .coverage coverage.xml  # Test reports htmlcov/  # PyInstaller dist/ build/ *.spec  # Virtual Environment venv/ .env/ .venv/`

---

### ✅ 3. `.gitignore` 파일 생성 위치

`BACKEND/.gitignore` 경로에 위 내용을 가진 파일을 생성하세요.

---

### ✅ 4. 이미 `.env`가 Git에 올라갔다면?

bash

복사편집

`git rm --cached .env`

로 Git에서만 제거하고, 이후 커밋에 반영하세요.



# JWT settings

SECRET_KEY=your_access_secret_key

REFRESH_SECRET_KEY=your_refresh_secret_key

ALGORITHM=HS256

ACCESS_TOKEN_EXPIRE_MINUTES=15

REFRESH_TOKEN_EXPIRE_DAYS=7




그리고 우리는 pyJWT를 사용안하기로 했다. 

질문하기! 난 python-jose를 쓸거야. 그거에 맞게 내  코드를 수정해줘. 나 RS256 같은 알고리즘을 사용해.




![[Pasted image 20250328153346.png]]

내 상태를 저장하고 싶으면 Zustand로 보내야한다. 즉 store에 보내야 한다. 

Zuatand는 엄청 빠르고, 화면의 전환이 부드럽고, 마이페이지로 전환될때 빠르게 미리 만들어 놓은 느낌이 있다.

로그드 인 유저를 마이페이지에 보내야 하니까 주스텐드로 보내야한다.

엑시오스는 라우터에 


axios 옆에다가 token이 없으면 매일 회원가입 하는거와 똑같다. 그래서 axios 옆에 access token을 붙여줘야ㅕ하고 , 이때 붙이기 위해 interceptor가 필요하다. 


access token은 인제 신경안써도 되고, refresh token만 관리해주면 된다.

토큰과 페이로드를 분리시키는게 속도도 더 빠르고, 

그래서 아래와 같은 파일을 만듬.

**![[Pasted image 20250328155832.png]]**