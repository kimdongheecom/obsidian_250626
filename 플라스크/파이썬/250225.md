2ì°¨ì› ë§¤íŠ¸ë¦­ìŠ¤....



í˜„ì—…ì—ì„œëŠ” column ëŒ€ì‹ ì— propertyë¼ê³  ë¶€ë¥¸ë‹¤.

ìƒíƒœì— ë”°ë¼ ã…‚ë€ë‹¤. - ìƒíƒœ (í–‰ë™ íŒ¨í„´)

csv ëŠ” ë² ëŸ¬ë¸”ì´ë‹¤. 

ëª¨ë“  íŒ¨í„´ì€ 

### ìƒê´€ ê´€ê³„

ì˜ˆì‹œ) ë‹¤ìŒì€ ì„œìš¸ì‹œ êµ¬ë³„ cctv ì„¤ì¹˜ ì •ë³´ì™€ í•´ë‹¹ ì§€ì—­ì˜ ë²”ì£„ ê±´ìˆ˜, ì„œìš¸ì‹œ ì¸êµ¬ ë°ì´í„°, ì„œìš¸ì‹œ ì •ë³´ ì§€ë„ì…ë‹ˆë‹¤. ì´ë¥¼ ê°€ì§€ê³ , ë²”ì£„ìœ¨ê³¼ ì¸êµ¬ìˆ˜ ëŒ€ë¹„ ì ì • cctv ë¥¼ ì œì•ˆí•˜ëŠ” AIëª¨ë¸ì„ êµ¬í˜„í•˜ì‹œì˜¤.

- ë‘ ë³€ìˆ˜(CSV) ì‚¬ì´ì˜ í•œ ë³€ìˆ˜ì˜ ë³€í™”ê°€ ë‹¤ë¥¸ ë³€ìˆ˜ì˜ ë³€í™”ì™€ ê´€ë ¨ì´ ìˆëŠ”ì§€ ë¶„ì„í•˜ëŠ” ê²ƒ.
- ìƒê´€ê´€ê³„ëŠ” ìŒì˜ ê´€ê³„ ì–‘ì˜ ê´€ê³„ë¥¼ ë”°ì§ˆ ë•Œ, ë¹„ì§€ë„í•™ìŠµì—ì„œ ë‚˜ì˜¨ë‹¤.
- 


### ì§€ë„ í•™ìŠµê³¼ ë¹„ì§€ë„ í•™ìŠµ

- ì°¨ì´ì : ë¼ë²¨(ì •ë‹µ)ì´ ìˆê³ , ì—†ê³ ì˜ ì°¨ì´ê°€ ìˆë‹¤.
- ì§€ë„ í•™ìŠµ: ë¼ë²¨ì´ ìˆë‹¤. ì˜ˆ) íƒ€ì´íƒ€ë‹‰ ë¬¸ì œ
- ë¹„ì§€ë„ í•™ìŠµ: ë¼ë²¨ì´ ì—†ë‹¤. ê·¸ë¦¬ê³  ë¶€ ë³€ìˆ˜(CSV) ê°„ì˜ ìƒê´€ ê´€ê³„ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ ë°ì´í„°ë¥¼ í•©ì³ì•¼ í•œë‹¤.
- í•©ì¹  ë•Œ, í‚¤ ê°’ì´ ê°™ì•„ì•¼ í•œë‹¤.
- 



apiëŠ” ì™¸ë¶€ì— ìˆëŠ” ê²ƒ.....
ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë‚´ê°€ ì™¸ë¶€ì—ì„œ ë‚´ë¶€ë¡œ ê°€ì ¸ì™€ì„œ, ë‚´ë¶€ì— ì €ì¥ë˜ì–´ ìˆëŠ” ìƒíƒœë¥¼ ì˜ë¯¸í•œë‹¤. 


### ê°ì²´ ì§€í–¥ì˜ ì¥ì 

1) ë³´ì•ˆê³¼ ì¬ ì‚¬ìš©
   - í‚¤: ë³´ì•ˆ




### OOP ê°ì²´ ì§€í–¥ í”„ë¡œê·¸ë¨

1. reuse
2. encription

### ê°œì¸ í”„ë¡œì íŠ¸ ìˆœì„œ (2 ë²ˆì§¸)

1. ëª¨ë¸ì— ì´ë©”ì¼ê³¼ ë¹„ë²ˆìœ¼ë¡œ íšŒì›ê°€ì… ì§„í–‰ì‹œí‚¤ë©´, ë°˜ê°‘ìŠµë‹ˆë‹¤. ì œì„ìŠ¤ ì…ë‹ˆë‹¤ë¡œ ì§„í–‰ì‹œí‚¬ ê²ƒì´ë‹¤. 
2. ì´ë©”ì¼, íŒ¨ìŠ¤ì›Œë“œ, ìœ ì €ë„¤ì„ ëª¨ë¸ ë§Œë“¤ê³ , ì„œë¹„ìŠ¤ ë§Œë“ ë‹¤. 


ë°ì´í„° ë¶„ì„ì€ ìŠ¤í…Œí‹±ì´ í•„ìš”í•˜ë‹¤.

ì•± ì›¹ ë§Œë“œëŠ” ê²ƒì€ ë‹¤ì´ë‚˜ë¯¹ì´ í•„ìš”í•˜ë‹¤.

```python
import os
import pandas as pd
from com.kimdonghee.models.seoul.data_reader import DataReader
from com.kimdonghee.models.seoul.dataset import Dataset
from com.kimdonghee.models.seoul import save_dir
from com.kimdonghee.models.seoul.google_map_singleton import GoogleMapSingleton

class SeoulService:

Â  Â  dataset = Dataset() Â  #Dataset()ì„ datasetì´ë¼ê³  ì´ ì•ˆì—ì„œ ë¶€ë¥´ê² ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.
Â  Â  reader = DataReader()

Â  Â  # csv íŒŒì¼ ì €ì¥

Â  Â  # í˜„ì¬ ìŠ¤í¬ë¦½íŠ¸ì˜ ì ˆëŒ€ ê²½ë¡œ ê°€ì ¸ì˜¤ê¸°

Â  Â  # ì €ì¥í•  ë””ë ‰í† ë¦¬ ì„¤ì •(ìŠ¤í¬ë¦½íŠ¸ ìœ„ì¹˜ ê¸°ì¤€)

  

Â  Â  def preprocess(self, *args) -> object:

Â  Â  Â  Â  print("---------ëª¨ë¸ ì „ì²˜ë¦¬ ì‹œì‘ ----------")

Â  Â  Â  Â  temp = []

Â  Â  Â  Â  for i in list(args): #argsë¥¼ í’€ê¸° ìœ„í•´ tempë¥¼ ë§Œë“¤ì—ˆë‹¤. tempë¥¼ ì˜®ê²¨ ë‹´ê¸° ìœ„í•´ í¬ë¬¸ì„ ëŒë ¸ë‹¤.

Â  Â  Â  Â  Â  Â  print(f"args ê°’ ì¶œë ¥: {i}")

Â  Â  Â  Â  Â  Â  temp.append(i)

  

Â  Â  Â  Â  this = self.dataset

Â  Â  Â  Â  print(f"*"*20, "ğŸ”°1. cctv í¸ì§‘")

Â  Â  Â  Â  this.cctv = self.create_matrix(temp[0])

Â  Â  Â  Â  this = self.update_cctv(this)

Â  Â  Â  Â  this = self.save_object_to_csv(this, os.path.join(save_dir, 'cctv_in_seoul.csv'))

  

Â  Â  Â  Â  print(f"*"*20, "ğŸ”°2. crime í¸ì§‘")

Â  Â  Â  Â  this.crime = self.create_matrix(temp[1])

Â  Â  Â  Â  this = self.update_crime(this)

Â  Â  Â  Â  this = self.save_object_to_csv(this, os.path.join(save_dir, 'crime_in_seoul.csv'))

Â  Â  Â  Â  print(f"*"*20, "ğŸ”°3. pop í¸ì§‘")

Â  Â  Â  Â  this.pop = self.create_matrix(temp[2])

Â  Â  Â  Â  this = self.update_pop(this)

Â  Â  Â  Â  this = self.save_object_to_csv(this, os.path.join(save_dir, 'pop_in_seoul.csv'))

Â  Â  Â  Â  return this

Â  Â  def create_matrix(self,fname) -> object: #selfëŠ” ìê¸° ë°ì´í„°ë¥¼ ê°€ì§€ê³  ì˜¤ê² ë‹¤ë¼ëŠ” ì˜ë¯¸. #new_modelì€ ëª¨ë¸ì„ ë§Œë“œëŠ” ê²ƒì„ ì˜ë¯¸í•¨. fnameì´ë¼ëŠ” íŒŒì¼ëª…ì„ ë°›ê³  objectëŠ” íƒ€ì…ì„ ì˜ë¯¸í•¨.

Â  Â  Â  Â  reader = self.reader #selfê°€ ë¶™ìœ¼ë©´ propertyì¸ ê²ƒì„ ì•Œìˆ˜ ìˆë‹¤. ê·¸ë¦¬ê³  self.datasetì„ thisë¼ê³  ì„¤ì •í•˜ì˜€ë‹¤.

Â  Â  Â  Â  print(f"ğŸ˜ğŸ¥‡ğŸ°ì»¨í…ìŠ¤íŠ¸ ê²½ë¡œ : {reader.context}")

Â  Â  Â  Â  print(f"ğŸ˜ğŸ¥‡ğŸ°íŒŒì¼ëª… : {fname}")

Â  Â  Â  Â  reader.fname = fname

Â  Â  Â  Â  if fname.endswith('csv'):

Â  Â  Â  Â  Â  Â  return reader.csv_to_dframe()

Â  Â  Â  Â  elif fname.endswith('xls'):

Â  Â  Â  Â  Â  Â  return reader.xls_to_dframe(header = 2, usecols = 'B,D,G,J,N')

  
  
  

Â  Â  def save_object_to_csv(self, this, param_path) -> object:

Â  Â  Â  Â  print(f"ğŸŸğŸ§ˆğŸ¥™save_csv ì²˜ìŒ: {param_path}")

Â  Â  Â  Â  param_path = os.path.join(save_dir, "cctv_in_seoul.csv")

Â  Â  Â  Â  if not os.path.exists(param_path) and param_path == "cctv_in_seoul.csv":

Â  Â  Â  Â  Â  Â  print(f"ğŸ¤ğŸ¦ªğŸ›1-cctv_in_seoul. {param_path}")

Â  Â  Â  Â  Â  Â  this.cctv.to_csv(os.path.join(save_dir, "cctv_in_seoul.csv"), index = False)

Â  Â  Â  Â  Â  Â  this = self.cctv_ratio(this)

Â  Â  Â  Â  elif os.path.exists(param_path) and param_path == "crime_in_seoul.csv":

Â  Â  Â  Â  Â  Â  Â print(f"ğŸ¤ğŸ¦ªğŸ›2-crime_in_seoul. {param_path}")

Â  Â  Â  Â  Â  Â  Â this.crime.to_csv(os.path.join(save_dir, "crime_in_seoul.csv"), index = False)

Â  Â  Â  Â  elif os.path.exists(param_path) and param_path == "pop_in_seoul.csv":

Â  Â  Â  Â  Â  Â  print(f"ğŸšğŸ™ğŸ˜3- pop_in_seoul. {param_path}")

Â  Â  Â  Â  Â  Â  this.pop.to_csv(os.path.join(save_dir, "pop_in_seoul.csv"), index = False)

Â  Â  Â  Â  else:

Â  Â  Â  Â  Â  Â  print(f"íŒŒì¼ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤.{param_path}")

Â  Â  Â  Â  return this

  
  

Â  Â  @staticmethod

Â  Â  def update_cctv(this) -> object:

Â  Â  Â  Â  print("cctv ë°ì´í„° í—¤ë“œ", this.cctv.head())

Â  Â  Â  Â  print("ğŸš¥ğŸš¦", this.cctv)

Â  Â  Â  Â  this.cctv = this.cctv.drop(['2013ë…„ë„ ì´ì „','2014ë…„', '2015ë…„', '2016ë…„'], axis = 1)

Â  Â  Â  Â  cctv = this.cctv

Â  Â  Â  Â  cctv = this.cctv.rename(columns={"ê¸°ê´€ëª…": "ìì¹˜êµ¬"})

Â  Â  Â  Â  cctv.to_csv(os.path.join(save_dir, "cctv_position.csv"), index=False) #ë‚´ê°€ ìˆëŠ” ìœ„ì¹˜ì—ì„œ position_policeì— ëŒ€í•œ ë°ì´í„°ë¥¼ saved_dataì— ì˜¬ë ¤ì¤˜.....ì˜¬ë¦´ ë•ŒëŠ” ì  ë‘ê°œ ì“°ê³  /ë¥¼ ì“´ë‹¤.

Â  Â  Â  Â  this.cctv = cctv

Â  Â  Â  Â  print("ğŸŒ‹ğŸ—»ê¸°ê´€ëª…ì„ ìì¹˜êµ¬ë¡œ ë³€ê²½")

Â  Â  Â  Â  print(cctv)

Â  Â  Â  Â  return this

Â  Â  Â  Â  # Â #ì €ì¥í•  ë””ë ‰í† ë¦¬ ê²½ë¡œ ì„¤ì •

Â  Â  Â  Â  # save_dir = "C:\\Users\\bitcamp\\Documents\\kimdonghee250220\\com\\kimdonghee\\saved_data\\"

Â  Â  Â  Â  # # í´ë”ê°€ ì—†ìœ¼ë©´ ìƒì„±

Â  Â  Â  Â  # if not os.path.exists(save_dir):

Â  Â  Â  Â  # Â  Â os.makedirs(save_dir)

Â  Â  @staticmethod

Â  Â  def update_crime(this) -> object:

Â  Â  Â  Â  print("crime ë°ì´í„° í—¤ë“œ", this.crime.head())

Â  Â  Â  Â  crime = this.crime

Â  Â  Â  Â  station_names = [] #ê²½ì°°ì„œ ê´€ì„œëª… ë¦¬ìŠ¤íŠ¸

Â  Â  Â  Â  for name in crime['ê´€ì„œëª…']:

Â  Â  Â  Â  Â  Â  station_names.append('ì„œìš¸' + str(name[:-1]) +'ê²½ì°°ì„œ')

Â  Â  Â  Â  print("ğŸ‘®â€â™‚ï¸ğŸ‘®â€â™€ï¸ğŸ•µï¸â€â™€ï¸ê²½ì°°ì„œ ê´€ì„œëª… ë¦¬ìŠ¤íŠ¸", station_names)

Â  Â  Â  Â  station_addrs = [] #apiê´€ë ¨í•˜ì—¬ ì‘ì„±í•˜ì˜€ë‹¤.

Â  Â  Â  Â  station_lats = [] #latì€ ìœ„ë„

Â  Â  Â  Â  station_lngs = [] #lngì€ ê²½ë„

  

Â  Â  Â  Â  gmaps1 = Â GoogleMapSingleton()

Â  Â  Â  Â  gmaps2 = Â GoogleMapSingleton()

Â  Â  Â  Â  if gmaps1 is gmaps2:

Â  Â  Â  Â  Â  Â  print("ë™ì¼í•œ ê°ì²´ì´ë‹¤.")

Â  Â  Â  Â  else:

Â  Â  Â  Â  Â  Â  print("ë‹¤ë¥¸ ê°ì²´ ì…ë‹ˆë‹¤.")

Â  Â  Â  Â  gmaps = GoogleMapSingleton()

Â  Â  Â  Â  for name in station_names:

Â  Â  Â  Â  Â  Â  tmp = gmaps.geocode(name, language = 'ko')

Â  Â  Â  Â  Â  Â  print(f"""{name}ì˜ ê²€ìƒ‰ ê²°ê³¼:, {tmp[0].get("formatted_address")}""" ) #ë”•ì…”ë„ˆë¦¬ì— ë‹´ì•„ì ¸ ìˆê¸° ë•Œë¬¸ì— í”„ë¦°í„°ë¥¼ ë”•ì…”ë„ˆë¦¬ì— ë‹´ì•„ì ¸ ìˆë‹¤.

Â  Â  Â  Â  Â  Â  station_addrs.append(tmp[0].get("formatted_address"))

Â  Â  Â  Â  Â  Â  tmp_loc = tmp[0].get("geometry")

Â  Â  Â  Â  Â  Â  station_lats.append(tmp_loc['location']['lat'])

Â  Â  Â  Â  Â  Â  station_lats.append(tmp_loc['location']['lng'])

Â  Â  Â  Â  print(f"ğŸšˆğŸš…ìì¹˜êµ¬ ë¦¬ìŠ¤íŠ¸:, {station_addrs}")

Â  Â  Â  Â  gu_names = []

Â  Â  Â  Â  for addr in station_addrs:

Â  Â  Â  Â  Â  Â  tmp = addr.split()

Â  Â  Â  Â  Â  Â  tmp_gu = [gu for gu in tmp if gu[-1] == 'êµ¬'][0]

Â  Â  Â  Â  Â  Â  gu_names.append(tmp_gu)

Â  Â  Â  Â  [print(f"ìì¹˜êµ¬ ë¦¬ìŠ¤íŠ¸ 2: {gu_names}")]

Â  Â  Â  Â  crime['ìì¹˜êµ¬'] = gu_names

Â  Â  Â  Â  # #ì €ì¥í•  ë””ë ‰í† ë¦¬ ê²½ë¡œ ì„¤ì •

  

Â  Â  Â  Â  # CSV íŒŒì¼ ì €ì¥

Â  Â  Â  Â  crime.to_csv(os.path.join(save_dir, "police_position.csv"), index=False) #ë‚´ê°€ ìˆëŠ” ìœ„ì¹˜ì—ì„œ position_policeì— ëŒ€í•œ ë°ì´í„°ë¥¼ saved_dataì— ì˜¬ë ¤ì¤˜.....ì˜¬ë¦´ ë•ŒëŠ” ì  ë‘ê°œ ì“°ê³  /ë¥¼ ì“´ë‹¤.

Â  Â  Â  Â  this.crime = crime

Â  Â  Â  Â  return this

  

Â  Â  Â  Â  # crime_position_path = os.path.join(save_dir, 'crime_position.csv')

Â  Â  Â  Â  # if not os.path.exists(crime_position_path):

Â  Â  Â  Â  # Â  Â print("ğŸš¨ ğŸ‘©â€ğŸ«ğŸ‘©â€ğŸ«ğŸ‘¨â€ğŸ“ğŸ‘¨â€ğŸ“ê¹€ë™í¬ 1")

Â  Â  Â  Â  # Â  Â gmaps = DataReader.create_gmaps()

Â  Â  Â  Â  # else:

Â  Â  Â  Â  # Â  Â print("ğŸ‘©â€ğŸ«ğŸ‘©â€ğŸ«ğŸ‘¨â€ğŸ“ğŸ‘¨â€ğŸ“ê¹€ë™í¬ 2")

Â  Â  @staticmethod

Â  Â  def update_pop(this) -> object:

Â  Â  Â  Â  pop = this.pop

Â  Â  Â  Â  pop.rename(columns = {

Â  Â  Â  Â  Â  Â  pop.columns[1]: 'ì¸êµ¬ìˆ˜',

Â  Â  Â  Â  Â  Â  pop.columns[2]: 'í•œêµ­ì¸',

Â  Â  Â  Â  Â  Â  pop.columns[3]: 'ì™¸êµ­ì¸',

Â  Â  Â  Â  Â  Â  pop.columns[4]: 'ê³ ë ¹ì',}, inplace = True)

Â  Â  Â  Â  print("ğŸ¥½ë°ì´í„° í—¤ë“œ", this.pop.head())

Â  Â  Â  Â  pop.to_csv(os.path.join(save_dir, "pop_in_seoul.csv"), index=False) #ë‚´ê°€ ìˆëŠ” ìœ„ì¹˜ì—ì„œ position_policeì— ëŒ€í•œ ë°ì´í„°ë¥¼ saved_dataì— ì˜¬ë ¤ì¤˜.....ì˜¬ë¦´ ë•ŒëŠ” ì  ë‘ê°œ ì“°ê³  /ë¥¼ ì“´ë‹¤.

Â  Â  Â  Â  this.pop = pop

Â  Â  Â  Â  return this
```