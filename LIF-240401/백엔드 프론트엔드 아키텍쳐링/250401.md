

### backend 기본 과정

1. 메인 라우터 만들기
```
from fastapi import FastAPI

from fastapi.responses import HTMLResponse

from datetime import datetime

  

def current_time():

    now = datetime.now()

    return now.strftime("%Y년 %m월 %d일 %H시 %M분 %S초")

  

app = FastAPI()

  

@app.get(path="/")

async def home():

    print("현재 시간: ", current_time())

    return HTMLResponse(content=f"""

<body>

<div style="width: 400px; margin: 50 auto;">

    <h1> 현재 서버 구동 중입니다.</h1>

    <h2> {current_time()}</h2>

</div>

</body>

""")
```

2. 도메인 만들기 및 아래 파일 만들기


아래 참조

![[Pasted image 20250401111216.png]]

3. 도커에 컨테이너 올리기 위해 다음과 같은 명령어 쓰기
docker compose up -d

4. 도커에 올리고 나서 명령 후, 새로고침하기

docker compose up

5. localhost:8000 사이트에서 누르기

![[Pasted image 20250401111644.png]]


## 프론트엔드 및 백엔드 아키텍쳐링

- 기존 v1 백엔드 아키텍쳐: DDD로 구조되어 있었음 
    
- 기존 v1 프론트엔트 아키텍쳐: 이벤트 주도로 구조되어 있었음
    
- v2의 모든 백엔드와 프론트 엔드는 DDD와 이벤트 주도를 섞어서 사용해야 함(앞으로도 실무에서 이렇게 사용할 예정)
    
- 슬러시가 3개 이상인 경우, death가 생기면 안 좋은 아키텍쳐를 의미함



서비스 레이어 아키텍쳐: 서비스 계층으로 나누는 설계 방식
- 모델, 서비스, 컨트롤러 아래에 user, customer, 등등이 잇다.


DDD(아키텍쳐 개발 방법론 중 하나)아래에 도메인 센트릭( 지금 내가 사용하는 방식이 도메인 센트릭이다.)을 사용하는 것 이다.


서버 리스: 이벤트 중심....프론트에 줌점을 두겠다.

프론트 --> 기능별로.... 관심사 분리가 되어있다. 이벤트 주도로 되어있다. 이벤트 중점으로 서비스 레이어 아키텍쳐로 구성되어있다.


도메인(서버): 도메인 센트릭 아키텍쳐

프론트: 서비스 레이어 아키텍쳐


이벤트 주도의 장점: 빠르다.


라우팅 걸리는 부분이 서비스 주도 개발로 이용한다.




쳇 gpt에 물어볼 것

(기술스텍을 보여주면서....) 이제 위 구조를 기반으로 백엔드 아키텍쳐를 설계하려고 합니다. 아키텍쳐 구조는 DDD와 EDA를 혼합한 방식을 채택하려고 합니다. 위 구조로 설계한 예시 파일은 다음과 같습니다. 현재까지 진행된 아키텍쳐가 실제 회사에서 쓰는 아키텍쳐에 적합한 지 검토하고 추가적으로 제 프로젝트 주제와 관련한 폴더와 파일을 추가해주세요. 대신 폴더명과 파일명은 누구나 이해할 수 있는 명확하고 간단한 이름이어야 합니다!


```
project-root/
│
├── com/
│   └── kimdonghee/
│       ├── api/                          ← ✅ FastAPI 라우터 계층
│       │   ├── v1/
│       │   │   └── account/
│       │   │       ├── __init__.py
│       │   │       ├── account_router.py
│       │   │       ├── customer_router.py
│       │   │       └── user_router.py
│       │   └── app_router.py             ← 전체 라우터 연결
│
│       ├── core/                         ← ✅ 설정, 유틸 등 핵심 모듈
│       │   ├── config/
│       │   │   └── base_config.py        ← DB 등 환경 설정
│       │   ├── settings/
│       │   │   └── .env                  ← 환경변수
│
│       ├── domain/                       ← ✅ 도메인 계층 (DDD)
│       │   └── account/
│       │       ├── manager/
│       │       │   ├── event_handler.py
│       │       │   ├── models/
│       │       │   ├── repository/
│       │       │   └── service/
│       │       └── user/
│       │           ├── event_handler.py
│       │           ├── models/
│       │           ├── repository/
│       │           ├── service/
│       │           ├── sql/
│       │           └── __init__.py
│       └── dashboard/                    ← 대시보드 도메인 (예정)

├── infrastructure/
│   └── database/
│       └── redis/
│           └── redis_client.py           ← Redis 클라이언트 설정

├── repositories/
│   ├── user_repo.py                      ← 공통 레포지토리 (통합형이면 유지)
│   └── __init__.py

├── tests/                                ← ✅ 테스트 계층
│   ├── api/
│   ├── domain/
│   └── infrastructure/

├── .dockerignore
├── .gitignore
├── docker_command.txt
├── docker-compose.yml
├── Dockerfile
├── main.py                               ← ✅ FastAPI 실행 진입점
└── requirements.txt

```


## ✅ 핵심 개념 요약

|개념|설명|
|---|---|
|**DDD (도메인 주도 설계)**|비즈니스 로직을 역할/기능별로 잘게 나누고 책임을 명확히 하여 유지보수를 쉽게 하는 구조|
|**EDA (이벤트 주도 아키텍처)**|어떤 일이 일어나면(이벤트), 그에 따라 반응(핸들러)이 실행되는 구조|
|**계층적 아키텍처**|`api → service → repository` 순으로 데이터와 책임이 이동함|


📁 디렉토리 구조 쉽게 설명

```
project-root/
│
├── com/kimdonghee/
│   ├── api/              ← 🔹 외부 요청 받는 라우터 (URL 진입점)
│   ├── core/             ← 🔹 환경설정, 공통 유틸 (비즈니스와 무관)
│   ├── domain/           ← 🔸 핵심 로직 (비즈니스 중심 - DDD)
│   └── dashboard/        ← 🔸 ESG 시각화 도메인 (추가 가능성)
│
├── infrastructure/       ← 🔹 Redis, DB 같은 기술적 요소 (기반 구조)
├── repositories/         ← 🔹 여러 도메인에서 공통으로 쓸 DB 접근 모음
├── tests/                ← 🔹 자동화 테스트 코드
├── main.py               ← 🔹 FastAPI 앱 시작점

```


🔄 데이터 흐름 예시 (사용자 정보 조회)
```
[요청: GET /account/user/me]  
↓
api/v1/account/user_router.py
↓
domain.account.user.service.user_service.py
↓
domain.account.user.repository.user_repository.py
↓
DB 조회 or Redis 조회
↓
응답 반환

```


## 🧩 각 구성요소 쉽게 설명

|폴더|역할|비유|
|---|---|---|
|`api/`|외부에서 요청 받는 입구|✋ 접수 창구|
|`domain/`|진짜 중요한 로직|🧠 두뇌|
|`service/`|비즈니스 규칙 처리|💼 실무 담당|
|`repository/`|DB 읽고 쓰기|📂 서류 창고|
|`event_handler.py`|일이 일어난 후 추가 작업 처리|📢 알림반응기|
|`core/`|설정, 보안, 환경변수 등|🛠️ 건물 설비|
|`infrastructure/`|Redis 등 외부 시스템 연동|🔌 전기/인터넷|
|`main.py`|프로그램 실행 시작점|🔑 정문|


## ✅ 왜 이 구조가 좋은가요?

- 유지보수가 쉬움 → 각 폴더 책임이 분명
    
- 협업에 적합 → 역할별로 작업 분리 가능
    
- 확장 가능 → 새로운 도메인 추가해도 영향 적음
    
- 실무에서 통용 → 스타트업부터 대기업까지 사용

## ✅ 1. `"user 도메인 흐름 예시 코드 보여줘"`

### 📁 전체 흐름 요약: `GET /account/user/me`


```
[요청] → user_router.py
         → user_service.py
           → user_repository.py
             → DB 조회
           ← 유저 정보 반환
         ← 응답 반환

```



## 🧠 요약

| 계층              | 역할                              |
| --------------- | ------------------------------- |
| `router`        | 외부 요청을 받아 처리 (FastAPI 엔드포인트)    |
| `service`       | 비즈니스 로직 처리, 이벤트 발생              |
| `repository`    | DB와 통신 (데이터 읽고 쓰기)              |
| `event_handler` | 이벤트 발생 후 부가 작업 수행 (Redis, 알림 등) |