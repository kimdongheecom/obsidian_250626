
개인 프로젝트 도커에 postgres 데이터 베이스(DB) 만들기

도커: 플라스크의 아나콘다 같은 느낌... 넓은 땅을 의미함.
postgres는 데이터 베이스를 의미함. 데이터 베이스 종류는 많다. 관계형 데이터 베이스 관리 방법 중 하나이다. 

먼저, 데이터 베이스 postrgre를 주입하기 전에, docker를 다운받아야 한다. 그리고 그 다음에 쳇지피티에 물어보았다.


1. postgres 데이터 베이스 설치




container = docker(빈 용기), 
images = 라이브러리
volumes = 



이미지 (추가적으로 물어보기)

1. 이미지가 라이브러리인 경우


2.  이미지가 라이브러리와 좀 다른 경우






git add. 깃에다가 추가하는 것

git commit -m 자기 로컬에 저장하는 것

git push 깃에 푸쉬하면서 컨테이너가 비워진다.



pull은 컨테이너에 땡겨서 담는 것

```python
docker( docker라는 명령어이다.) run --(뒤에 값이 예)name 등, 아무것도 없으면 갖고와라. 뒤에 값이 있으면 값을 할당하라는 뜻이다.)name postgres-container ` -e POSTGRES_USER=myuser ` -e POSTGRES_PASSWORD(대문자로 쓰여있으면 상수, 전역 상수이다)=mypassword ` -e POSTGRES_DB=mydatabase ` -p 5432:5432 ` -d postgres
```


- - e 환경 변수이다.

POSTGRES_USER=myuser ` -e POSTGRES_PASSWORD (바뀌면 안되는 건 상수로 표시...대문자로 쓰여있는 것 보니까 상수임을 알 수 있다)

postgres-container 바뀌어야 하는 것은 변수로 표시


POSTGRES_DB=mydatabase 5432:5432는 postgres-container의 방번호(5432:)와 비밀번호(5432)를 말한다. 

### 데몬

데몬(Daemon)은 **백그라운드에서 실행되면서 특정 작업을 수행하는 프로세스**를 의미합니다. container. image, volume은 볼 수가 없다. 사실 front 뒤에 데몬이 있다. 

![[Pasted image 20250228172052.png]]


아래 사진은 도커를 통제하는 녀석들이다.
![[Pasted image 20250228172136.png]]



### 도커랑 FastAPI 연결 과정


1. 도커랑 FastAPI를 연결시키기 위해, 파일을 만들기 위해 아래처럼 쳇 지피티에 명령을 해줬다.
![[Pasted image 20250228165343.png]]


도커랑 fastAPI랑 연결 아직 안된 상태이다. 


당신의 프로젝트(`Backend/` 폴더)에 Docker를 연결하기 위한 설정을 단계별로 설명해 드리겠습니다.

---

## **📌 1. 프로젝트 구조**

현재 프로젝트 폴더 구조는 다음과 같습니다:

Backend/
│── __pycache__/
│── com/
│   ├── kimdonghee/
│       ├── auth/
│       ├── petro/
│── main.py
│── requirements.txt  (필요하면 생성)
│── Dockerfile
│── .dockerignore
│── docker-compose.yml (선택)



---

## **📌 2. `requirements.txt` 생성**

FastAPI 애플리케이션을 실행하기 위해 필요한 패키지를 정리합니다.

📄 **`requirements.txt`**

![[Pasted image 20250228170309.png]]


---

## **📌 3. Dockerfile 작성**

📄 **`Dockerfile`**

![[Pasted image 20250228170327.png]]

---

## **📌 4. `.dockerignore` 파일 작성**

Docker 이미지에 불필요한 파일이 포함되지 않도록 설정합니다.

![[Pasted image 20250228170337.png]]

---

## **📌 5. Docker 이미지 빌드**

이제 터미널에서 Docker 이미지를 빌드합니다.

![[Pasted image 20250228170352.png]]
---

## **📌 6. Docker 컨테이너 실행**

Docker 컨테이너를 실행합니다.

![[Pasted image 20250228170403.png]]

---

## **📌 7. 실행 확인**

FastAPI 애플리케이션이 정상적으로 실행되는지 확인하려면:

![[Pasted image 20250228170413.png]]

---

## **📌 8. Docker Compose 사용 (선택)**

Docker Compose를 사용하면 여러 컨테이너를 쉽게 관리할 수 있습니다.

📄 **`docker-compose.yml`**

![[Pasted image 20250228170452.png]]
#### **Compose 실행**

![[Pasted image 20250228170441.png]]
---

## **🎯 정리**

1. `requirements.txt`로 의존성 관리
2. `Dockerfile`을 작성하여 FastAPI를 컨테이너화
3. `.dockerignore`로 불필요한 파일 제외
4. `docker build -t fastapi-backend .` 로 이미지 빌드
5. `docker run -d -p 8000:8000 fastapi-backend` 로 컨테이너 실행
6. `http://localhost:8000`에서 실행 확인
7. 필요하면 `docker-compose.yml`을 사용하여 여러 서비스 관리 가능

이제 프로젝트를 Docker와 연동하여 실행할 준비가 완료되었습니다! 🚀

4o

##### 나의 말:

docker run --name postgres-container `-e POSTGRES_USER=myuser` -e POSTGRES_PASSWORD=mypassword `-e POSTGRES_DB=mydatabase` -p 5432:5432 `-d postgres 맨 마지막에 실행할 때, 이미 저 위에 있는 코드 실행했어. 나는 실행만 하고 싶을 때, 어떤 코드를 써?`

###### ChatGPT의 말:

이미 `docker run`을 실행해서 컨테이너가 생성되었다면, 다음과 같은 방법으로 PostgreSQL 컨테이너를 실행할 수 있습니다.

---

### **1. 컨테이너 다시 시작**
![[Pasted image 20250228170537.png]]

---

### **2. 컨테이너 상태 확인**

현재 실행 중인 컨테이너를 확인하려면:
![[Pasted image 20250228170554.png]]

---

### **3. 컨테이너 중지 후 다시 실행**

이미 실행 중이라면 먼저 중지한 후 다시 실행할 수도 있습니다.

![[Pasted image 20250228170610.png]]

---

### **4. 컨테이너가 존재하지 않는 경우**

만약 `docker ps -a`에서 `postgres-container`가 존재하지 않는다면 컨테이너를 새로 만들어야 합니다.

![[Pasted image 20250228170621.png]]
---

### **5. 컨테이너 자동 실행 설정**

만약 서버가 재부팅될 때 자동으로 실행되도록 설정하고 싶다면, 컨테이너 실행 시 `--restart` 옵션을 추가해야 합니다.

![[Pasted image 20250228170635.png]]
또는 기존 컨테이너에 대해 자동 재시작을 활성화하려면:
![[Pasted image 20250228170645.png]]
---

## **🚀 정리**

| 원하는 작업                   | 명령어                                                 |
| ------------------------ | --------------------------------------------------- |
| 기존 컨테이너 실행               | `docker start postgres-container`                   |
| 현재 실행 중인 컨테이너 확인         | `docker ps`                                         |
| 모든 컨테이너 확인 (종료된 컨테이너 포함) | `docker ps -a`                                      |
| 컨테이너 중지                  | `docker stop postgres-container`                    |
| 컨테이너 삭제                  | `docker rm postgres-container`                      |
| 새 컨테이너 실행                | `docker run ... -d postgres`                        |
| 컨테이너 자동 실행 설정            | `docker update --restart always postgres-container` |

이제 `docker start postgres-container`만 실행하면 PostgreSQL 컨테이너를 다시 시작할 수 있습니다. 🚀
