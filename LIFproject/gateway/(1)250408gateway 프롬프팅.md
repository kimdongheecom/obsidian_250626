ì—…ë°ì´íŠ¸:250416
ì—…ë°ì´íŠ¸:250422
### -- users í´ë” --
**ì»¤ì„œ ì§ˆë¬¸,**

gateway/  
â”œâ”€â”€ app/  
â”‚ â”œâ”€â”€ __init__.py  
â”‚ â”œâ”€â”€ main.py  â† FastAPI ì§„ì…ì  
â”œâ”€â”€ .env  
â”œâ”€â”€ requirements.txt  
â”œâ”€â”€ Dockerfile  
â”œâ”€â”€ docker-compose.yml  
â””â”€â”€ README.md  
  
ì´ êµ¬ì¡°ë¡œ ë§Œë“¤ì–´ì£¼ê³  docker-compose.ymlì„ í†µí•´ fastapië¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ í•´ì¤˜. ë„ì»¤fileì—ì„œ íŒŒì´ì¬ë²„ì „ì€ 3.12.7ì´ê³  reloadì˜µì…˜ì„ ì¶”ê°€í•´ì¤¬ìœ¼ë©´ í•´. ê·¸ë‹¤ìŒì— portëŠ” 8080ìœ¼ë¡œ í•´ì¤˜. ë„ë©”ì¸ ì£¼ì†ŒëŠ” www.jinmini.com ì´ì•¼. APIRouter ìƒì„±ìì˜ prefixëŠ” /eë¡œ í•˜ê³ , asyncë°©ì‹ìœ¼ë¡œ ì‘ë™ë˜ê²Œ í•´ì¤˜. requirements.txtì— ê¸°ë³¸ì ìœ¼ë¡œ ë“±ë¡ëœ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤. 
fastapi uvicorn asyncpg sqlalchemy python-dotenv pytz email_validator passlib[bcrypt]==1.7.4 shortuuid==1.0.13 python-jose[cryptography] redis==5.2.1 ê·¸ë¦¬ê³  ìµœì¢…ì ìœ¼ë¡œ swaggerì—ì„œ ("/")í•˜ë©´ Welcome Messageê°€ ëœ° ìˆ˜ ìˆê²Œ í•´ì¤˜. app.include_router(api_router)ì²˜ëŸ¼ appì´ api_routerë¥¼ í¬í•¨í•˜ê²Œ í•´ì¤˜. ê·¸ë¦¬ê³  __init__.pyì—ëŠ” ì–´ë– í•œ ì½”ë”©ì‘ì—…ë„ í•˜ì§€ë§ˆ. 

í¬íŠ¸ë²ˆí˜¸, ë„ë©”ì¸ ì£¼ì†Œ, prefixì„ ì•Œë ¤ì¤˜ì•¼ í•¨.

**ì»¤ì„œ ì§ˆë¬¸,**
main.pyì—ì„œ hello worldë¥¼ ì‹¤í–‰í•˜ê²Œ í•´ì¤˜.


**ì»¤ì„œ ì§ˆë¬¸,**
pip install fastapi uvicorn ì´ê²ƒ ëŒ€ì‹ ì—  requirements.txtë¡œ í•˜ê³ , ì‹¤í–‰ì„ Dockerfile, docker-compose up -dë¡œ í•˜ë„ë¡ í•´ì¤˜.


**ì½˜ì†” ì°½ì— ëª…ë ¹ì–´ ì¶”ê°€**
ê·¸ë¦¬ê³  ì²˜ìŒ ì‹¤í–‰í•˜ëŠ”ê±°ë‹ˆê¹Œ, **docker-compose up --build -d** ëª…ë ¹ì–´ë¥¼ í•´ì¤˜ì•¼ í•œë‹¤. 


**ì½˜ì†” ì°½ì— ëª…ë ¹ì–´ ì¶”ê°€**
ê·¸ë¦¬ê³  ì»¨í…Œì´ë„ˆê°€ ì—†ì„ ê²½ìš°ì—ëŠ” docker-compose up -dë¥¼ í•´ì£¼ë©´ ëœë‹¤. 



![[Pasted image 20250408150134.png]]

ì´ ë‹¤ìŒ ë‹¨ê³„ëŠ” 250417 íŒŒì¼ì— ë³´ë©´ ëœë‹¤.
#### gateway í´ë” ìƒì„± ë° sweaggerì—ì„œ ë„ìš°ê¸° ê³¼ì •!!!!!

**model íŒŒì¼ ë§Œë“¤ê¸°**

app/domain/gateway/models í´ë”ì—Â gateway_model.pyÂ íŒŒì¼ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.

ê¸°ë³¸Â ì½”ë“œì—ì„œÂ ë‹¤ìŒê³¼ ê°™ì´Â í™•ì¥í–ˆìŠµë‹ˆë‹¤:

1. OptionalÂ íƒ€ì…ê³¼ datetime ëª¨ë“ˆì„ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤

2. OAuthEntityÂ ëª¨ë¸ì— ë‹¤ìŒ í•„ë“œë¥¼Â ì¶”ê°€í–ˆìŠµë‹ˆë‹¤:

	- refresh_token:Â ì„ íƒì ì¸Â ë¦¬í”„ë ˆì‹œ í† í° í•„ë“œ
	
	- expires_at: í† í° ë§Œë£ŒÂ ì‹œê°„
	
	- created_at: ì—”í‹°í‹° ìƒì„± ì‹œê°„Â (ê¸°ë³¸ê°’ìœ¼ë¡œ í˜„ì¬Â ì‹œê°„ ì„¤ì •)

3.  Config í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ ORMê³¼ í†µí•©í•  ìˆ˜ ìˆë„ë¡ from_attributesÂ ì˜µì…˜ì„ ì„¤ì •í–ˆìŠµë‹ˆë‹¤

ì´ ëª¨ë¸ì€Â ì—¬ëŸ¬ OAuthÂ ì œê³µìë¡œë¶€í„° ë°›ì€ ì¸ì¦ ì •ë³´ë¥¼Â ì €ì¥í•˜ëŠ” ë°Â ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


**schema íŒŒì¼ ë§Œë“¤ê¸°**

1. OAuthSchemaÂ í´ë˜ìŠ¤:

	- providerì™€ code í•„ë“œëŠ”Â ê·¸ëŒ€ë¡œ ìœ ì§€
	
	- redirect_uri í•„ë“œ ì¶”ê°€Â (ì„ íƒì )
	
	- ConfigÂ í´ë˜ìŠ¤ë¥¼ í†µí•´ JSONÂ ìŠ¤í‚¤ë§ˆ ì˜ˆì œ ì¶”ê°€í•˜ì—¬ API ë¬¸ì„œ ê°œì„ 

2. OAuthResponseSchema í´ë˜ìŠ¤Â ì¶”ê°€:

	- access_token: OAuth ì¸ì¦ ê²°ê³¼ë¡œÂ ë°›ì€ ì•¡ì„¸ìŠ¤ í† í°
	
	- token_type: í† í° íƒ€ì…Â (ê¸°ë³¸ê°’: "Bearer")
	
	- expires_in: í† í°Â ë§Œë£Œ ì‹œê°„Â (ì´ˆ ë‹¨ìœ„)
	
	- refresh_token: ë¦¬í”„ë ˆì‹œ í† í° (ì„ íƒì )
	
	- scope: í† í°ì˜Â ê¶Œí•œ ë²”ìœ„Â (ì„ íƒì )
	
	- created_at: í† í° ìƒì„± ì‹œê°„ (í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ìë™Â ì„¤ì •)

ì´ ìŠ¤í‚¤ë§ˆë“¤ì€ OAuth ì¸ì¦ ê³¼ì •ì—ì„œ ìš”ì²­ê³¼ ì‘ë‹µÂ ë°ì´í„°ë¥¼ ê²€ì¦í•˜ê³  ì§ë ¬í™”í•˜ëŠ”Â ë° ì‚¬ìš©í• Â ìˆ˜ ìˆìŠµë‹ˆë‹¤.


**repository íŒŒì¼ ë§Œë“¤ê¸°**

OAuthRepository í´ë˜ìŠ¤ì—Â ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ ê¸°ëŠ¥ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.Â ì£¼ìš” êµ¬í˜„Â ë‚´ìš©ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. ë°ì´í„°ë² ì´ìŠ¤Â ì—°ê²° ê´€ë¦¬:

	- asyncpg ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œÂ PostgreSQL ì—°ê²° í’€ ê´€ë¦¬
	
	- í™˜ê²½ ë³€ìˆ˜ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´Â ê°€ì ¸ì˜¤ê¸°
	
	- ì—°ê²°Â íšë“ ë° í•´ì œë¥¼Â ìœ„í•œ í—¬í¼Â ë©”ì„œë“œ

2. í…Œì´ë¸” ì´ˆê¸°í™”:

	- init_table()Â ë©”ì„œë“œë¥¼ í†µí•´ í•„ìš”í•œ í…Œì´ë¸”ì„ ìƒì„±

3. CRUD ì‘ì—… êµ¬í˜„:

	- save_oauth(): OAuthÂ ì •ë³´ ì €ì¥ ë° ì—…ë°ì´íŠ¸
	
	- find_oauth_by_id(): IDë¡œ OAuth ì •ë³´ ì¡°íšŒ
	
	- find_oauth_by_provider():Â ì œê³µìë³„Â OAuth ì •ë³´ ì¡°íšŒ
	
	- delete_oauth(): OAuth ì •ë³´Â ì‚­ì œ

4. ì˜ˆì™¸Â ì²˜ë¦¬:

	- ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤Â ì‘ì—…ì— ì˜ˆì™¸ ì²˜ë¦¬ ì¶”ê°€
	
	- ì˜¤ë¥˜ ë¡œê¹…

5. ë©”ëª¨ë¦¬ ìºì‹œ:

	- ë°ì´í„°ë² ì´ìŠ¤Â ì—°ê²°ì´ ì—†ëŠ” ê°œë°œ í™˜ê²½ì„ ìœ„í•œ ë©”ëª¨ë¦¬ ì €ì¥ì†ŒÂ êµ¬í˜„

ë˜í•œ,Â .env íŒŒì¼ì— ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´ë¥¼Â ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ì´ì œ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°í•˜ì—¬Â OAuth ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ì¡°íšŒí• Â ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**service íŒŒì¼ êµ¬í˜„í•˜ê¸°**

app/domain/gateway/servicesÂ í´ë”ì— gateway_service.py íŒŒì¼ì„ ìƒì„±í•˜ê³  OAuthService í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.Â ì´ ì„œë¹„ìŠ¤ëŠ” ìš”ì²­í•œ ì½”ë“œë¥¼Â ê¸°ë°˜ìœ¼ë¡œ í™•ì¥ë˜ì—ˆìœ¼ë©° ë‹¤ìŒê³¼ ê°™ì€Â ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:

1. ì´ˆê¸°í™” ë° ì„¤ì •:

	- ë ˆí¬ì§€í† ë¦¬ ì´ˆê¸°í™” ë° DBÂ í…Œì´ë¸” ìƒì„±
	
	- ë‹¤ì–‘í•œ OAuthÂ ì œê³µì(Google, Facebook, GitHub) ì§€ì›

2. OAuth í•µì‹¬ ê¸°ëŠ¥:

	- create_oauth: ì¸ì¦ ì½”ë“œë¥¼ í† í°ìœ¼ë¡œ êµí™˜í•˜ê³  ì €ì¥
	
	- get_oauth_by_id,Â get_oauth_by_provider: ì €ì¥ëœÂ OAuth ì •ë³´ ì¡°íšŒ
	
	- refresh_oauth_token: ë§Œë£Œëœ í† í°Â ê°±ì‹ 
	
	- delete_oauth: OAuth ì •ë³´Â ì‚­ì œ

3. ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™:

	- _exchange_code_for_token: ì¸ì¦ ì½”ë“œë¡œÂ í† í° ìš”ì²­
	
	- _refresh_token: ë¦¬í”„ë ˆì‹œ í† í°ìœ¼ë¡œ ìƒˆÂ í† í° ìš”ì²­
	
	- _get_provider_config:Â ì œê³µìë³„ ì„¤ì • ì •ë³´ ê°€ì ¸ì˜¤ê¸°

4. ë³´ì•ˆ ë° ì—ëŸ¬ ì²˜ë¦¬:

	- ì˜ˆì™¸ ì²˜ë¦¬Â ë° ë¡œê¹…
	
	- í™˜ê²½ ë³€ìˆ˜ë¥¼Â í†µí•œ ë¯¼ê° ì •ë³´Â ê´€ë¦¬

ë˜í•œÂ .env íŒŒì¼ì—Â OAuth í´ë¼ì´ì–¸íŠ¸ ì •ë³´ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ì´ì œ ì‚¬ìš©ìëŠ”Â ì‹¤ì œ ì‚¬ìš©í•˜ëŠ” OAuthÂ í´ë¼ì´ì–¸íŠ¸Â IDì™€ ì‹œí¬ë¦¿ìœ¼ë¡œ ì´ ê°’ë“¤ì„ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤.

ì´ ì„œë¹„ìŠ¤ë¥¼ í†µí•´ ë‹¤ì–‘í•œ OAuth ì œê³µìë¥¼Â í†µí•©í•˜ì—¬ ì¸ì¦í• Â ìˆ˜ ìˆìœ¼ë©°, í† í° ê´€ë¦¬ì™€ ê°±ì‹ ë„ ìë™ìœ¼ë¡œ ì²˜ë¦¬í• Â ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**controller íŒŒì¼ êµ¬í˜„**
gateway_controller.py íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ìš”ì²­í•˜ì‹  ì½”ë“œë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. ì´ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë‹¤ìŒê³¼ ê°™ì€ OAuthÂ ê´€ë ¨ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì œê³µí•©ë‹ˆë‹¤:

1. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œÂ OAuth í…Œì´ë¸” ì´ˆê¸°í™”Â ê¸°ëŠ¥

2. IDë¡œÂ OAuth ì •ë³´ ì¡°íšŒ (GET /oauth/{oauth_id})

3. ì œê³µìë³„ OAuth ì •ë³´ ì¡°íšŒÂ (GET /oauth?provider={provider})

4. OAuth ì¸ì¦ ì •ë³´Â ìƒì„± (POST /oauth)

5. OAuth í† í° ê°±ì‹  (POST /oauth/{oauth_id}/refresh)

6. OAuth ì •ë³´ ì‚­ì œÂ (DELETE /oauth/{oauth_id})

ì´ì œ ì´ ë¼ìš°í„°ë¥¼ main.pyì— ë“±ë¡í•˜ë©´ í•´ë‹¹ ê²½ë¡œë¡œ APIë¥¼Â ì‚¬ìš©í•  ìˆ˜ ìˆê²ŒÂ ë©ë‹ˆë‹¤. main.py íŒŒì¼ì„ ìˆ˜ì •í•˜ì‹œë ¤ë©´ ë‹¤ìŒê³¼Â ê°™ì´ ë³€ê²½í•´ì£¼ì„¸ìš”:

#### access_tokenê³¼ refresh_tokenì„ ë°œê¸‰ë°›ê³ , sweaggerì—ì„œ í† í°ì´ ì°íˆë©´ ì„±ê³µ(ëª©í‘œ)!!!!!

**ì»¤ì„œ ì§ˆë¬¸, (ì•„ë˜ ì‚¬ì§„ì„ ì²¨ë¶€í•˜ë©´ì„œ) gatewayê°€ swaggerì— ë„ë‹¬í•œ ìƒíƒœì•¼. ì§€ê¸ˆ ë‚˜ëŠ” oauthë¡œ êµ¬í˜„í•˜ë ¤ê³  í•´. joseë¡œ í† í°ì„ ê´€ë¦¬í• ê±°ì•¼. ì„ì‹œë¡œ ë”ë¯¸í‚¤ë¥¼ ê°€ì§€ê³ , sweaggerì—ì„œ í…ŒìŠ¤íŠ¸ í•˜ë ¤ê³  í•  ë•Œ, ë­˜ í•´ì•¼í• ê¹Œ? ë‹¨ê³„ì ìœ¼ë¡œ ì•Œë ¤ì¤˜.**

![[Pasted image 20250416180733.png]]
ìœ„ì˜ ë‹¨ê³„ëŠ” ë‹¤ìŒ ì¥(êµ¬ê¸€ê³„ì •, ë„¤ì´ë²„ ê³„ì •, ì¹´ì¹´ì˜¤ ê³„ì • ì—°ê²°-250417)ì— ì‘ì„±ë˜ì–´ ìˆìŒ...



**ì»¤ì„œ ì§ˆë¬¸, ë”ë¯¸ í† í°ì„ ì§‘ì–´ë„£ì–´ì„œ sweaggerì—ì„œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸ í•˜ë ¤ê³ , api í´ë” ì•„ë˜ì— tokens_router.py íŒŒì¼ì„ ë§Œë“¤ê³ , domain í´ë” ì•„ë˜ì— ìˆëŠ” gatewayì— token_controller.py, token_model.py, token_repository.py, token_schema.py, token_service.py íŒŒì¼ì„ ë§Œë“¤ì—ˆì–´. ë‚œ ë¨¼ì €, @token_schema.py ì—¬ê¸°ì— ì•„ë˜ ì½”ë“œë¥¼ ë‚´ ì½”ë“œì— ë§ì¶°ì„œ êµ¬í˜„í•´ì¤˜. ì½”ë“œëŠ” ìµœëŒ€í•œ ê°„ë‹¨í•˜ê²Œ í•´ì¤˜. ê·¸ë¦¬ê³  í† í°ì€ joseê°€ ê´€ë¦¬í•˜ë„ë¡ í•´ì¤˜. ê·¸ë¦¬ê³  apië°‘ì— ìˆëŠ” token_router.pyê°€ ìˆìœ¼ë‹ˆê¹Œ token_router.py íŒŒì¼ì„ ìƒˆë¡œ ìƒì„±í•˜ì§€ ë§ê³ , @tokens_router.py ì—¬ê¸°ì— ì—°ê²°ì‹œì¼œ. 


#### íë¦„ ìˆœì„œê°€ ì•„ë˜ ì²˜ëŸ¼ ëœë‹¤.

1. token_scema.py ì½”ë“œ êµ¬í˜„
2. token_model.py ì½”ë“œ êµ¬í˜„
3. token_repository.py ì½”ë“œ êµ¬í˜„
4. token_service.py ì½”ë“œ êµ¬í˜„
5. token_controller.py ì½”ë“œ êµ¬í˜„
6. token_router.pyì— ì—°ê²° ì‹œí‚¤ê¸°(ì—°ê²°ì‹œí‚¬ ë•Œ, token_controller.pyì™€ token_schema.pyë¥¼ ì„í¬íŠ¸ í•´ì•¼í•¨.)

#### êµ¬í˜„ëœ íŒŒì¼ ìš”ì•½

1. í† í° ìŠ¤í‚¤ë§ˆ(app/domain/gateway/schemas/token_schema.py):

	- TokenSchema: í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë°›ì€ í† í°ì„ ê²€ì¦í•˜ëŠ” ê°„ë‹¨í•œ ìŠ¤í‚¤ë§ˆ
	
	- TokenResponseSchema: í† í° ë°œê¸‰ ì‘ë‹µ ìŠ¤í‚¤ë§ˆ
	
	- TokenVerifyResponseSchema: í† í° ê²€ì¦ ê²°ê³¼ ìŠ¤í‚¤ë§ˆ
	

2.  í† í° ëª¨ë¸(app/domain/gateway/models/token_model.py):

	- í† í° ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” ê°„ë‹¨í•œ ëª¨ë¸


 3. í† í° ì €ì¥ì†Œ(app/domain/gateway/repositories/token_repository.py):

	- ë©”ëª¨ë¦¬ ê¸°ë°˜ì˜ ê°„ë‹¨í•œ í† í° ì €ì¥ì†Œ


4. í† í° ì„œë¹„ìŠ¤(app/domain/gateway/services/token_service.py):

	- Jose ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œ JWT í† í° ìƒì„± ë° ê²€ì¦
	
	- ë”ë¯¸ í† í° ìƒì„± ê¸°ëŠ¥ í¬í•¨



5. í† í° ì»¨íŠ¸ë¡¤ëŸ¬(app/domain/gateway/controllers/token_controller.py):

	- ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí•˜ê³  ì˜ˆì™¸ ì²˜ë¦¬


6. ê¸°ì¡´ í† í° ë¼ìš°í„° í™•ì¥(app/api/gateway/tokens_router.py):

	- ê¸°ì¡´ ë¼ìš°í„°ì— í† í° ìƒì„±, ê²€ì¦, íê¸°, ë”ë¯¸ í† í° ìƒì„± ê¸°ëŠ¥ ì¶”ê°€



ì´ì œ ë‹¤ìŒ ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ í† í° ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- /tokens/createÂ - ìƒˆ í† í° ìƒì„±

- /tokens/verifyÂ - í† í° ê²€ì¦

- /tokens/revokeÂ - í† í° íê¸°

- /tokens/dummyÂ - í…ŒìŠ¤íŠ¸ìš© ë”ë¯¸ í† í° ìƒì„±


#### ëª©í‘œ
ê·¸ë¦¬ê³  ë”ë¯¸ ë°ì´í„°ë¥¼ ì‚¬ìš©ìê°€ sweaggerì— ì…ë ¥í–ˆì„ ë•Œ, ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë”ë¯¸ ë°ì´í„° ê°’ì´ access_tokenê³¼ ì¼ì¹˜í•´ì•¼ í•˜ê³ , ê·¸ ê°’ì€ ì½˜ì†” ì°½ì— ë„ì–´ì•¼ í•œë‹¤. ìŠ¤ì›¨ê±°ëŠ” ì…ë ¥ ì°½ì´ê³ , ìŠ¤ì›¨ê±°ì— ì…ë ¥ì„ í–ˆì„ ë•Œ, ë§Œì•½ ì½˜ì†” ì°½ì— ê·¸ ê°’ì´ ë„ì–´ì§€ë©´ ë„ì»¤ ì»¨í…Œì´ë„ˆì— ë“¤ì–´ì˜¨ ê²ƒì„ ì˜ë¯¸í•œë‹¤. 

###### ëª©í‘œ ìš”ì•½

- Swaggerì—ì„œ ** body parameterë¡œ ììœ ë¡­ê²Œ ë¬¸ìì—´ ì…ë ¥**
    
- FastAPIì—ì„œ í•´ë‹¹ ê°’ì„ **ë°›ì•„ì„œ ì½˜ì†”ì— ì¶œë ¥**
    
- Swagger ì‘ë‹µì€ ê°„ë‹¨í•œ ë©”ì‹œì§€ë§Œ ë¦¬í„´í•´ë„ OK





















### gateway í´ë” ìƒì„± ë° auth í´ë” ì—°ê²° before ê³¼ì • 
#### ì´ ê³¼ì •ì„ í†µí•´ F12ë¥¼ ëˆŒë €ì„ ë•Œ, ë¸Œë¼ìš°ì € ì½˜ì†”ì°½ì— access_tokenê³¼ refresh_token ë„ìš°ê¸°

#### ("FastAPI ê¸°ë°˜ Gateway â€“ User Service í”„ë¡ì‹œ ì—°ë™ ì™„ë£Œ)


**ì³‡ ì§€í”¼í‹° ì§ˆë¬¸** (gateway í´ë”)
![[Pasted image 20250408154809.png]]

**ìœ„ì—ì„œ í˜„ì¬ msaë¥¼ ê³„ì† ì‘ì—… ì¤‘ì´ì•¼. ì´ë¯¸ì§€ì²˜ëŸ¼ gatewayì—ì„œ authë¡œ ì—°ê²°í•˜ëŠ” ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ë¥¼ gatewayì— ì¶”ê°€í•˜ê³  ì‹¶ì–´. "/api/users"ë¥¼ swaggerì—ì„œ ì‹¤í–‰í•˜ë©´ Welcome ë©”ì‹œì§€ë¥¼ ë³´ê²Œí•˜ê³  ì‹¶ì–´.**



**ì»¤ì„œ ì§ˆë¬¸,** (gateway í´ë”)
**@main.py(gateway(êº¼ì˜ ë©”ì¸ë¼ìš°í„°ì´ë‹¤.... ì´ ê´„í˜¸ ë¹¼ê³  ì»¤ì„œì— ì§ˆë¬¸í•˜ê¸°.) ì—¬ê¸°ì— GATEWAY ì„œë¹„ìŠ¤: AUTHë¡œ í”„ë¡ì‹œ ìš”ì²­ ë³´ë‚´ê¸°ë¥¼ êµ¬í˜„í•´ì¤˜.**


**ì»¤ì„œ ì§ˆë¬¸,** (gateway í´ë”)
**'AUTH_SERVICE_URL = os.getenv("AUTH_SERVICE_URL", "http://localhost:8001")' ë¶€ë¶„ì„ .envë¡œ ì˜®ê²¨ì£¼ê³ , main.pyì—ì„œëŠ” ì‚­ì œí•´ì¤˜.** 



**ì»¤ì„œ ì§ˆë¬¸,   (gateway í´ë”)**
**@docker-compose.yml ì— volumes ì¶”ê°€í•´ì¤˜.**


**ì»¤ì„œ ì§ˆë¬¸, (auth í´ë”)**

ê·¸ë¦¬ê³ , gatewayì—ì„œ authë¥¼ ì—°ê²°í•  ë•Œ, ì¶©ëŒì´ ë‚  ìˆ˜ ìˆìœ¼ë‹ˆê¹Œ auth í´ë”ì—ì„œ docker-compose,ymlì„ ì‚­ì œí•´ì•¼í•¨.


ê·¸ ì´í›„.....


## ğŸš€ 3. ë°°í¬ ìˆœì„œ ì •ë¦¬

| ìˆœì„œ  | ì‘ì—… ë‚´ìš©                                                 |
| --- | ----------------------------------------------------- |
| 1.  | `user-service`, `board-service` ë“±ì„ **FastAPIë¡œ ë¶„ë¦¬ ê°œë°œ** |
| 2.  | ê°ê°ì„ **Dockerize**í•˜ê³  Railwayì— ê°œë³„ ë°°í¬                    |
| 3.  | **gateway ì„œë¹„ìŠ¤**ë¥¼ FastAPIë¡œ ë§Œë“¤ì–´ Dockerize & Railwayì— ë°°í¬ |
| 4.  | `.env` íŒŒì¼ì— ì„œë¹„ìŠ¤ ì£¼ì†Œ ë„£ê¸°                                  |
| 5.  | Vercelì˜ Next.js í”„ë¡ íŠ¸ì—ì„œ gateway ì£¼ì†Œë¡œ í†µì‹ í•˜ê²Œ êµ¬ì„±             |
| 6.  | ëª¨ë“  ì„œë¹„ìŠ¤ëŠ” **ê°™ì€ PostgreSQL DB ì¸ìŠ¤í„´ìŠ¤**ë¥¼ ê³µìœ                  |
## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ ìš”ì•½

|í•­ëª©|ì‚¬ìš© ê¸°ìˆ |
|---|---|
|Backend Gateway|FastAPI + httpx (Proxy ì—­í• )|
|Microservices|FastAPI + SQLAlchemy (í˜¹ì€ Alchemy 2.0)|
|DB|PostgreSQL (Railway ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤)|
|Frontend|Next.js 15 (Vercelì— ë°°í¬)|
|ë°°í¬|Docker + Railway (ì„œë¹„ìŠ¤ë³„ í”„ë¡œì íŠ¸)|
|CI/CD|GitHub Actions (ì„ íƒ)|


#### ì—¬ê¸°ì„œë¶€í„° 3ë²ˆë¶€í„° ì£¼ëª©! ìš°ë¦° ì§€ê¸ˆê¹Œì§€ 2ë²ˆê¹Œì§€ í–ˆìŒ!
(ì¶”ê°€ ë°°ê²½ ì„¤ëª…... ê·¸ë¦¬ê³  [https://chatgpt.com/share/67f4a244-92fc-8011-bba4-b5fbacc7285c](https://chatgpt.com/share/67f4a244-92fc-8011-bba4-b5fbacc7285c)ë§í¬ë¥¼ ì°¸ì¡°í•˜ë©´ ë°°í¬ ìˆœì„œê°€ ë‚˜ì˜¤ëŠ”ë°, ìœ„ì˜ ë°°í¬ ìˆœì„œì—ì„œ ë‚˜ëŠ” 1,2 ë‹¨ê³„ë¥¼ ì™„ì„±í–ˆê³ , 3ë‹¨ê³„ gateway ì„œë¹„ìŠ¤ë¥¼ fastAPIë¡œ ë§Œë“¤ì–´ Dockerize & Railwayì— ë°°í¬ë¥¼ í•˜ë„ë¡ ì´ ë¶€ë¶„ë§Œ ì•Œë ¤ì¤˜. ì¼ë‹¨ nextJSì—ì„œ /api/user/loginìœ¼ë¡œ ìš”ì²­í•˜ë©´ gatewayì— apië¥¼ ì§€ë‚˜ëŠ” ê²ƒì„ printë¡œ í™•ì¸ì‹œì¼œì¤˜.)

**ë‹µë³€!**

ì¢‹ìŠµë‹ˆë‹¤! í˜„ì¬ MSA êµ¬ì¡°ì—ì„œÂ `**GATEWAY**`Â ì„œë¹„ìŠ¤ì—ì„œÂ `**AUTH**`Â ì„œë¹„ìŠ¤ë¡œÂ **ê²½ë¡œë¥¼ í”„ë¡ì‹œ(ì—°ê²°)**Â í•˜ì—¬Â `/api/users`Â í˜¸ì¶œ ì‹œ AUTHì—ì„œ ì‘ë‹µí•˜ëŠ” êµ¬ì¡°ë¥¼ ë§Œë“¤ê³  ì‹¶ìœ¼ì‹  ê±°êµ°ìš”.![:í°ìƒ‰_í™•ì¸_í‘œì‹œ:](https://a.slack-edge.com/production-standard-emoji-assets/14.0/google-medium/2705.png)Â ëª©í‘œ ìš”ì•½  

- **MSA êµ¬ì¡°**: FastAPI ê¸°ë°˜ ì„œë¹„ìŠ¤ ë¶„ë¦¬ (`GATEWAY`,Â `AUTH`)
- `GATEWAY`ì—ì„œÂ `/api/users`Â ìš”ì²­ â†’ ë‚´ë¶€ì ìœ¼ë¡œÂ `AUTH`ì˜Â `/users`ë¡œ í”„ë¡ì‹œ
- Swaggerì—ì„œÂ `GET /api/users`Â â†’Â `"Welcome from AUTH"`Â ë©”ì‹œì§€ ë°˜í™˜

![:í°ìƒ‰_í™•ì¸_í‘œì‹œ:](https://a.slack-edge.com/production-standard-emoji-assets/14.0/google-medium/2705.png)Â êµ¬ì¡° ìš”ì•½ ì˜ˆì‹œ  

GATEWAY/
  app/
    main.py   â† í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ìˆ˜ì‹  ë° AUTHë¡œ í”„ë¡ì‹œ
AUTH/
  app/
    main.py   â† /users ì—”ë“œí¬ì¸íŠ¸ ì •ì˜ (Welcome ë©”ì‹œì§€)

![:í°ìƒ‰_í™•ì¸_í‘œì‹œ:](https://a.slack-edge.com/production-standard-emoji-assets/14.0/google-medium/2705.png)Â 1. AUTH ì„œë¹„ìŠ¤:Â `/users`Â ì—”ë“œí¬ì¸íŠ¸ ì •ì˜  
`**AUTH/app/main.py**`  

from fastapi import FastAPI

app = FastAPI()

@app.get("/users")
def get_users():
    return {"message": "Welcome from AUTH service"}

![:í°ìƒ‰_í™•ì¸_í‘œì‹œ:](https://a.slack-edge.com/production-standard-emoji-assets/14.0/google-medium/2705.png)Â 2. GATEWAY ì„œë¹„ìŠ¤: AUTHë¡œ í”„ë¡ì‹œ ìš”ì²­ ë³´ë‚´ê¸°  
`**GATEWAY/app/main.py**`  

from fastapi import FastAPI
import httpx

app = FastAPI()

# AUTH ì„œë¹„ìŠ¤ì˜ ë‚´ë¶€ ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ì£¼ì†Œ (ì„œë¹„ìŠ¤ ì´ë¦„ìœ¼ë¡œ ì ‘ê·¼)
AUTH_SERVICE_URL = "[http://auth:8000](http://auth:8000/)"

@app.get("/api/users")
async def proxy_to_auth():
    async with httpx.AsyncClient() as client:
        response = await client.get(f"{AUTH_SERVICE_URL}/users")
        return response.json()

> ì—¬ê¸°ì„œÂ `"``[http://auth:8000](http://auth:8000/)``"`ì€Â `docker-compose.yml`ì— ì •ì˜ëœ ì„œë¹„ìŠ¤ ì´ë¦„ì„ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.

![:í°ìƒ‰_í™•ì¸_í‘œì‹œ:](https://a.slack-edge.com/production-standard-emoji-assets/14.0/google-medium/2705.png)Â 3. docker-compose.yml (GATEWAY + AUTH í¬í•¨)  
**ìµœìƒìœ„ì— í†µí•©ëœ**Â `**docker-compose.yml**`Â **ì˜ˆì‹œ:**  

version: "3.9"

services:
  gateway:
    build:
      context: ./GATEWAY
    ports:
      - "8000:8000"
    depends_on:
      - auth

  auth:
    build:
      context: ./AUTH
    ports:
      - "8001:8000"

![:í°ìƒ‰_í™•ì¸_í‘œì‹œ:](https://a.slack-edge.com/production-standard-emoji-assets/14.0/google-medium/2705.png)Â 4. GATEWAY/Dockerfile & AUTH/Dockerfile (ë‘˜ ë‹¤ ë™ì¼í•˜ê²Œ êµ¬ì„±)  

FROM python:3.11-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY ./app ./app
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]

![:í°ìƒ‰_í™•ì¸_í‘œì‹œ:](https://a.slack-edge.com/production-standard-emoji-assets/14.0/google-medium/2705.png)Â 5. requirements.txt (ê³µí†µ)  

fastapi==0.110.0
uvicorn[standard]==0.29.0
httpx==0.27.0

![:í°ìƒ‰_í™•ì¸_í‘œì‹œ:](https://a.slack-edge.com/production-standard-emoji-assets/14.0/google-medium/2705.png)Â 6. ì‹¤í–‰  
ë£¨íŠ¸ ê²½ë¡œì—ì„œ:  

docker compose up --build -d

![:í°ìƒ‰_í™•ì¸_í‘œì‹œ:](https://a.slack-edge.com/production-standard-emoji-assets/14.0/google-medium/2705.png)Â 7. Swagger í™•ì¸  
**GATEWAY Swaggerì—ì„œ ì ‘ì†:**  

[http://localhost:8000/docs](http://localhost:8000/docs)

`GET /api/users`Â í´ë¦­ â†’Â **"Welcome from AUTH service"**Â ë©”ì‹œì§€ ë°˜í™˜ í™•ì¸![:ì „êµ¬:](https://a.slack-edge.com/production-standard-emoji-assets/14.0/google-medium/1f4a1.png)Â ì¶”ê°€ íŒ  

- ì„œë¹„ìŠ¤ ì´ë¦„ìœ¼ë¡œ ì ‘ê·¼ (`auth:8000`)ì€ docker-composeì—ì„œë§Œ ê°€ëŠ¥
- ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ë¥¼ DNS ìˆ˜ì¤€ìœ¼ë¡œ ëŒ€ì‹ í•˜ëŠ” êµ¬ì¡° (ê°„ë‹¨í•˜ì§€ë§Œ MSA ê¸°ë°˜)
- ê³ ê¸‰ êµ¬ì¡°: API Gatewayë¡œÂ `Traefik`,Â `Kong`, ë˜ëŠ”Â `Envoy`ë„ ê³ ë ¤ ê°€ëŠ¥

ë„ì»¤ ë¹Œë“œ ì—ëŸ¬ë‚˜ ì‹¤ì œ ìš”ì²­ ì‹¤íŒ¨ê°€ ë°œìƒí•˜ë©´ ë¡œê·¸ ìº¡ì²˜ ì£¼ì‹œë©´ ë°”ë¡œ ë„ì™€ë“œë¦´ê²Œìš”.  
Â í•„ìš”í•˜ì‹œë©´ OpenAPI ì—°ë™ë„ gateway ìª½ swaggerì— í†µí•©í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•´ìš”!




### ìš”ì•½ ì •ë¦¬

#### íë¦„

Gateway â†’ Proxyâ†’ Service Discovery â†’ Microservices


#### ìš©ì–´ ì •ë¦¬

| ìš©ì–´                    | ì„¤ëª…                                            |
| --------------------- | --------------------------------------------- |
| **Gateway**           | ëª¨ë“  ì™¸ë¶€ ìš”ì²­ì˜ ì§„ì…ì  (API Gateway)                   |
| **Proxy**             | ìš”ì²­ì„ ì‹¤ì œ ì„œë¹„ìŠ¤ë¡œ **ì „ë‹¬**í•´ì£¼ëŠ” ê¸°ìˆ ì  ê¸°ëŠ¥ (í”„ë¡ì‹œ ë¯¸ë“¤ì›¨ì–´ or í•¨ìˆ˜) |
| **Service Discovery** | ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ë“¤ì˜ ì£¼ì†Œ(IP/PORT)ë¥¼ ì°¾ì•„ì£¼ëŠ” ì‹œìŠ¤í…œ               |
| **Microservices**     | ê¸°ëŠ¥ë³„ë¡œ ë‚˜ë‰œ ì„œë¹„ìŠ¤ë“¤ (user-service, report-service ë“±) |

#### íë¦„ ì„¤ëª…

```
[ì™¸ë¶€ ìš”ì²­]
   â†“
Gateway (FastAPI ì•± ì „ì²´)
   â†“
Proxy (ìš”ì²­ì„ ì–´ë””ë¡œ ë³´ë‚¼ì§€ ê²°ì •)
   â†“
Service Discovery (ì£¼ì†Œ ì°¾ì•„ì¤Œ)
   â†“
Microservices (ì‹¤ì œ ìš”ì²­ ì²˜ë¦¬)

```

- GatewayëŠ” "ë¬¸"
    
- ProxyëŠ” "ìš°í¸ë°°ë‹¬ë¶€"
    
- Service DiscoveryëŠ” "ì£¼ì†Œë¡"
    
- MicroserviceëŠ” "ì‹¤ì œ ì§‘"
    

ğŸ“Œ **ì¦‰, ProxyëŠ” Gateway ë‚´ë¶€ì— í¬í•¨ëœ ê¸°ëŠ¥ì´ê³ , ê·¸ Proxyê°€ Service Discoveryë¥¼ ì°¸ê³ í•´ì„œ ì „ë‹¬í•´ì¤Œ**

ì¦‰, Gateway = ìš”ì²­ì„ ë°›ì•„ì„œ â†’ ë‚´ë¶€ Proxyë¡œ ì²˜ë¦¬ â†’ ê·¸ Proxyê°€ Service Discoveryë¥¼ ì°¸ê³  â†’ ìš”ì²­ ì „ë‹¬


#### ë„ì‹ ì„¤ëª…

```
                    ğŸ”½ ì‚¬ìš©ì ìš”ì²­ (Next.js)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Gateway (FastAPI)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        Proxy (ë¼ìš°íŒ… ë¡œì§)           â”‚  â”‚
â”‚  â”‚   â†’ ì„œë¹„ìŠ¤ ì´ë¦„ìœ¼ë¡œ Service Lookup   â”‚  â”‚
â”‚  â”‚   â†’ Service Discovery ì¡°íšŒ           â”‚  â”‚
â”‚  â”‚   â†’ í•´ë‹¹ ì„œë¹„ìŠ¤ë¡œ ì „ë‹¬ (í”„ë¡ì‹œ ìš”ì²­) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        Microservice (user, report ë“±)

```
