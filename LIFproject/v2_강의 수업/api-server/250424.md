#### ì‹¤í–‰ìˆœì„œ
1. ë°±ì—”ë“œ git clone í•´ì„œ ë‹¤ìš´ë°›ê¸°
2. docker compose up --build -d ëª…ë ¹ì–´ í•˜ê¸°


3. ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ ì‹¤í–‰í•˜ê¸° ìœ„í•´ main.pyì—ì„œ ì•„ë˜ ì´ë¯¸ì§€ ë¶€ë¶„ì„ ìˆ˜ì •í•˜ê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì€ ì´ë¯¸ì§€ë¥¼ ì²¨ë¶€í•˜ê³ , ë‹¤ìŒê³¼ ê°™ì´ ì»¤ì„œì—ê²Œ ì§ˆë¬¸í•˜ì˜€ìŒ
	- **ì»¤ì„œ ì§ˆë¬¸,   @main.py ì—¬ê¸°ì—ì„œ ì„œë¹„ìŠ¤ë””ìŠ¤ì»¤ë²„ë¦¬ê°€ ì˜ëª»ë˜ì–´ì„œ ì´ì²˜ëŸ¼ ì˜ëª»ëœ ì½”ë“œë¡œ ì§„í–‰ë˜ì—ˆì–´. gatewayì˜ ë©”ì¸ ë¼ìš°í„°ëŠ” /eì´ê³ , financeserviceëŠ” /finì´ì–´ì„œ ì´ ë‘˜ì´ ê²°í•©í•´ì„œ /e/finì´ ë˜ë„ë¡ í•˜ê³  ì‹¶ì–´. ê·¸ëŸ°ë° ì´ ë¶€ë¶„ì€ login_router, prefix="/e"ì²˜ëŸ¼ login_routerë¥¼ /login ìœ¼ë¡œ í•˜ì§€ì•Šê³  /eë¡œ í•´ì„œ ë¬¸ì œê°€ ë¼. ì˜¬ë°”ë¥¸ ì„œë¹„ìŠ¤ë””ìŠ¤ì»¤ë²„ë¦¬ë¡œ ì‘ë™í•˜ë„ë¡ ìˆ˜ì •í•´ì£¼ê³ , ì•„ë˜ ì½”ë“œë¥¼ ì°¸ê³ í•´ì„œ ì‘ì„±í•´ì¤˜. ê·¸ë¦¬ê³  ì •ì ìœ¼ë¡œ êµ¬í˜„í•˜ê²Œ í•´ì¤˜.**
![[Pasted image 20250424164947.png]]



financeserviceì— ìˆëŠ” ë©”ì¸ë¼ìš°í„°ì—ì„œ @fin_router.py ì—°ê²°í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•´ì¤˜. ì´ê²Œ ë‚´ê°€ ì›í•˜ëŠ” ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ì•¼.



```
from typing import Any, Dict

from fastapi import APIRouter, FastAPI, Request

from fastapi.middleware.cors import CORSMiddleware

from fastapi.responses import JSONResponse

from contextlib import asynccontextmanager

import httpx

import os

from dotenv import load_dotenv

from contextlib import asynccontextmanager

  

# .env íŒŒì¼ ë¡œë“œ

load_dotenv()

  

# âœ… FastAPI ì•± ìƒì„±

app = FastAPI(

Â  Â  title="Gateway API",

Â  Â  description="Gateway API for jinmini.com",

Â  Â  version="0.1.0",

)

gateway_router = APIRouter(prefix="/e")

  

# âœ… CORS ì„¤ì •

app.add_middleware(

Â  Â  CORSMiddleware,

Â  Â  allow_origins=["*"],

Â  Â  allow_credentials=True,

Â  Â  allow_methods=["*"],

Â  Â  allow_headers=["*"],

)

  

# í™˜ê²½ ë³€ìˆ˜ì—ì„œ ì„œë¹„ìŠ¤ URL ê°€ì ¸ì˜¤ê¸°

FINANCE_SERVICE_URL = os.getenv("FINANCE_SERVICE_URL")

ESG_SERVICE_URL = os.getenv("ESG_SERVICE_URL")

STOCK_SERVICE_URL = os.getenv("STOCK_SERVICE_URL")

  

# âœ… ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ `init_db()` ì‹¤í–‰

@asynccontextmanager

async def lifespan(app: FastAPI):

Â  Â  print("ğŸš€ğŸš€ï¿½ï¿½ğŸš€ FastAPI ì•±ì´ ì‹œì‘ë©ë‹ˆë‹¤.")

Â  Â  print(f"âœ… FINANCE_SERVICE_URL: {FINANCE_SERVICE_URL}")

Â  Â  print(f"âœ… ESG_SERVICE_URL: {ESG_SERVICE_URL}")

Â  Â  print(f"âœ… STOCK_SERVICE_URL: {STOCK_SERVICE_URL}")

Â  Â  yield Â # ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆ ìœ ì§€

Â  Â  print("ğŸ›‘ FastAPI ì•±ì´ ì¢…ë£Œë©ë‹ˆë‹¤.")

  

app.include_router(gateway_router)

  

# Finance ì„œë¹„ìŠ¤ í”„ë¡ì‹œ ë¼ìš°í„° - HTTP ë©”ì„œë“œë³„ë¡œ ë¶„ë¦¬

@app.get("/e/fin/{path:path}")

async def proxy_finance_get(path: str, request: Request):

Â  Â  print(f"GET ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤: /e/fin/{path}")

Â  Â  async with httpx.AsyncClient() as client:

Â  Â  Â  Â  response = await client.request(

Â  Â  Â  Â  Â  Â  method="GET",

Â  Â  Â  Â  Â  Â  url=f"{FINANCE_SERVICE_URL}/fin/{path}",

Â  Â  Â  Â  Â  Â  headers=request.headers.raw

Â  Â  Â  Â  )

Â  Â  Â  Â  return response.json()

  

@app.post("/e/fin/{path:path}")

async def proxy_finance_post(path: str, request: Request):

Â  Â  print(f"POST ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤: /e/fin/{path}")

Â  Â  body = await request.body()

Â  Â  print(f"ìš”ì²­ ë³¸ë¬¸: {body}")

Â  Â  async with httpx.AsyncClient() as client:

Â  Â  Â  Â  response = await client.request(

Â  Â  Â  Â  Â  Â  method="POST",

Â  Â  Â  Â  Â  Â  url=f"{FINANCE_SERVICE_URL}/fin/{path}",

Â  Â  Â  Â  Â  Â  headers=request.headers.raw,

Â  Â  Â  Â  Â  Â  data=body

Â  Â  Â  Â  )

Â  Â  Â  Â  return response.json()

  

@app.put("/e/fin/{path:path}")

async def proxy_finance_put(path: str, request: Request):

Â  Â  print(f"PUT ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤: /e/fin/{path}")

Â  Â  async with httpx.AsyncClient() as client:

Â  Â  Â  Â  response = await client.request(

Â  Â  Â  Â  Â  Â  method="PUT",

Â  Â  Â  Â  Â  Â  url=f"{FINANCE_SERVICE_URL}/fin/{path}",

Â  Â  Â  Â  Â  Â  headers=request.headers.raw,

Â  Â  Â  Â  Â  Â  data=await request.body()

Â  Â  Â  Â  )

Â  Â  Â  Â  return response.json()

  

@app.delete("/e/fin/{path:path}")

async def proxy_finance_delete(path: str, request: Request):

Â  Â  print(f"DELETE ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤: /e/fin/{path}")

Â  Â  async with httpx.AsyncClient() as client:

Â  Â  Â  Â  response = await client.request(

Â  Â  Â  Â  Â  Â  method="DELETE",

Â  Â  Â  Â  Â  Â  url=f"{FINANCE_SERVICE_URL}/fin/{path}",

Â  Â  Â  Â  Â  Â  headers=request.headers.raw

Â  Â  Â  Â  )

Â  Â  Â  Â  return response.json()

  

# ESG ì„œë¹„ìŠ¤ í”„ë¡ì‹œ ë¼ìš°íŒ…

@app.api_route("/e/esg/{path:path}", methods=["GET", "POST", "PUT", "DELETE"])

async def proxy_esg(path: str, request: Request):

Â  Â  async with httpx.AsyncClient() as client:

Â  Â  Â  Â  response = await client.request(

Â  Â  Â  Â  Â  Â  method=request.method,

Â  Â  Â  Â  Â  Â  url=f"{ESG_SERVICE_URL}/esg/{path}",

Â  Â  Â  Â  Â  Â  headers=request.headers.raw,

Â  Â  Â  Â  Â  Â  data=await request.body()

Â  Â  Â  Â  )

Â  Â  Â  Â  return response.json()

  

@app.api_route("/e/stock/{path:path}", methods=["GET", "POST", "PUT", "DELETE"])

async def proxy_stock(path: str, request: Request):

Â  Â  async with httpx.AsyncClient() as client:

Â  Â  Â  Â  response = await client.request(

Â  Â  Â  Â  Â  Â  method=request.method,

Â  Â  Â  Â  Â  Â  url=f"{STOCK_SERVICE_URL}/stock/{path}",

Â  Â  Â  Â  Â  Â  headers=request.headers.raw,

Â  Â  Â  Â  Â  Â  data=await request.body()

Â  Â  Â  Â  )

Â  Â  Â  Â  return response.json()

  

# âœ… ì„œë²„ ì‹¤í–‰

if __name__ == "__main__":

Â  Â  import uvicorn

Â  Â  port = int(os.getenv("PORT", 8080))

Â  Â  uvicorn.run("app.main:app", host="0.0.0.0", port=port, reload=True)
```